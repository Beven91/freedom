{"version":3,"sources":["webpack:///../framework/app-page/index.js"],"names":["blackList","AppPage","name","Object","defineProperty","writable","value","lockFunction","unLockFunction","registerAppPage","getInitialState","handler","_lock","_unlock","options","context","target","venylog","sendOriginalBeancon","dataset","record","event","entry","sendEventBeancon","title","Preload","showLoading","hideLoading","image","duration","mask","showToast","arguments","hideToast","url","wx","redirectTo","navigateTo","delta","navigateBack","data","callback","instance","reflectKeys","a","proto","__proto__","ownKeys","filter","k","indexOf","map","key","adapterProperty","Page","onLoad","setData","bind","Venylog","route","apply","adapterFunction","locked","__locked","nowHandler","console","warn","push","unlock","response","index","setTimeout","splice"],"mappings":"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","file":"../framework/app-page/index.js","sourcesContent":["/**\r\n * 名称：微信小程序页面基础类\r\n * 日期：2017-12-24\r\n * 描述：修改微信小程序Page函数定义页面方式，改为class方式，\r\n *      例如:  Page({ ...}) 改为  class UserPage extends Page { ...}\r\n *      同时提供基础行为函数等\r\n */\r\n\r\n// 依赖导入>>\r\nimport dantejs from 'dantejs';\r\nimport Venylog from '../venylog';\r\nimport Preload from '../preload';\r\n\r\nconst blackList = [\r\n  \"lock\", \"_lock\", \"unlock\", \"_unlock\", \"constructor\", \"setData\"\r\n];\r\n\r\nexport default class AppPage {\r\n\r\n  /**\r\n   * 基础页面组件构造函数\r\n   * @param {String} name 页面名称，可用作打点页面名称\r\n   */\r\n  constructor(name) {\r\n    //定义函数锁\r\n    Object.defineProperty(this, '__locked', { writable: false, value: [] })\r\n    //锁定指定函数\r\n    Object.defineProperty(this, '_lock', { writable: false, value: lockFunction })\r\n    //解锁指定函数\r\n    Object.defineProperty(this, '_unlock', { writable: false, value: unLockFunction })\r\n    //注册微信小程序页面\r\n    registerAppPage(this, this.getInitialState(), name);\r\n  }\r\n\r\n  /**\r\n   * 锁定当前页面实例指定函数\r\n   * @param {Function} handler 要锁定的函数 注意：该函数必须为当前页面类定义的函数\r\n   * @example  this.lock(this.submit)\r\n   */\r\n  lock(handler) {\r\n    return this._lock(handler);\r\n  }\r\n\r\n  /**\r\n   * 解锁指定函数\r\n   * @param {Function} handler 要锁定的函数 注意：该函数必须为当前页面类定义的函数\r\n   * @example  this.unlock(this.submit)\r\n   */\r\n  unlock(handler) {\r\n    return this._unlock(handler);\r\n  }\r\n\r\n  /**\r\n   * 小程序页面生命周期函数--监听页面加载\r\n   * @param {*} options \r\n   */\r\n  onLoad(options) {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady() {\r\n  }\r\n\r\n  /** \r\n   * 小程序页面生命周期函数--监听页面显示\r\n   */\r\n  onShow() {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面生命周期函数--监听页面隐藏\r\n   */\r\n  onHide() {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面生命周期函数--监听页面卸载\r\n   */\r\n  onUnload() {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh() {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面页面上拉触底事件的处理函数\r\n   */\r\n  onReachBottom() {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面用户点击右上角转发\r\n   */\r\n  onShareAppMessage() {\r\n  }\r\n\r\n  /**\r\n   * 小程序页面页面滚动触发事件的处理函数\r\n   */\r\n  onPageScroll() {\r\n  }\r\n\r\n  /**\r\n   * 获取页面初始数据\r\n   */\r\n  getInitialState() {\r\n\r\n  }\r\n\r\n  /**\r\n   * tap事件打点\r\n   * 仅需要元素上配置如下属性\r\n   * <view data-veny-name=\"事件名称\" data-veny-param=\"参数\" ></view>\r\n   */\r\n  onVenylogBeancon(context) {\r\n    const target = context.target;\r\n    //发送打点日志\r\n    this.venylog.sendOriginalBeancon(target.dataset);\r\n  }\r\n\r\n  /**\r\n   * 发送一条打点日志\r\n   * @param {Object} record\r\n   */\r\n  sendBeancon(record) {\r\n    this.venylog.sendOriginalBeancon(record);\r\n  }\r\n\r\n  /**\r\n   * 发送一个事件日志\r\n   * @param {String} event 事件名称\r\n   * @param {String} entry 附带的消息 \r\n   */\r\n  sendEventBeancon(event, entry) {\r\n    this.venylog.sendEventBeancon(event, entry);\r\n  }\r\n\r\n  /**\r\n   * 显示loading效果\r\n   * @param {String} title 标题\r\n   */\r\n  showLoading(title) {\r\n    return Preload.showLoading(title || '请稍后...');\r\n  }\r\n\r\n  /**\r\n   * 关闭loading效果\r\n   */\r\n  hideLoading() {\r\n    return Preload.hideLoading();\r\n  }\r\n\r\n  /**\r\n   * 显示一个toast消息提示\r\n   * @param {String} title 要显示的文案\r\n   * @param {String} image icon图标\r\n   * @param {String} duration 提示的延迟时间，单位毫秒，默认：1500\r\n   * @param {Boolean} mask 是否显示透明蒙层，防止触摸穿透，默认：false\r\n   */\r\n  showToast(title, image, duration, mask) {\r\n    return Preload.showToast(...arguments);\r\n  }\r\n\r\n  /**\r\n   * 关闭toast消息提示\r\n   */\r\n  hideToast() {\r\n    return Preload.hideToast();\r\n  }\r\n\r\n  /**\r\n   * 关闭当前页面，跳转到应用内的某个页面。\r\n   * @param {String} url 要跳转到的页面 例如: pages/index/index\r\n   */\r\n  redirectTo(url) {\r\n    return wx.redirectTo({ url });\r\n  }\r\n\r\n  /**\r\n   * 保留当前页面，跳转到应用内的某个页面，使用wx.navigateBack可以返回到原页面。\r\n   * @param {String} url 要跳转到的页面 例如: pages/index/index\r\n   */\r\n  navigateTo(url) {\r\n    return wx.navigateTo({ url });\r\n  }\r\n\r\n  /**\r\n   * 关闭当前页面，返回上一页面或多级页面。可通过 getCurrentPages()) 获取当前的页面栈，决定需要返回几层。\r\n   * @param {Number} delta 返回的页面数，如果 delta 大于现有页面数，则返回到首页。\r\n   */\r\n  navigateBack(delta) {\r\n    return wx.navigateBack({ delta })\r\n  }\r\n\r\n  /**\r\n   * 设置数据函数用于将数据从逻辑层发送到视图层（异步），同时改变对应的 this.data 的值（同步）。\r\n   * @param {Object} data 这次要改变的数据\r\n   * @param {Function} callback 回调函数，在修改完数据后的回调函数\r\n   */\r\n  setData(data, callback) {\r\n    //具体会被page.setData覆盖 你可以搜索下registerAppPage函数看下覆盖位置\r\n  }\r\n}\r\n\r\n/**\r\n * 注册指定实例成为微信小程序页面\r\n */\r\nfunction registerAppPage(instance, data, name) {\r\n  const reflectKeys = (a) => Reflect.ownKeys(a);\r\n  const proto = instance.__proto__;\r\n  const ownKeys = [...reflectKeys(proto.__proto__), ...reflectKeys(proto), ...reflectKeys(instance)]\r\n  delete instance.data;\r\n  //原型属性对象化\r\n  ownKeys\r\n    .filter((k) => blackList.indexOf(k) < 0)\r\n    .map((key) => adapterProperty(instance, key))\r\n  //注册小程序页面\r\n  Page({\r\n    ...instance,\r\n    data: data,\r\n    onLoad() {\r\n      instance.setData = this.setData.bind(this);\r\n      instance.data = this.data;\r\n      instance.__proto__.__proto__.__proto__ = this;\r\n      //添加打点日志对象\r\n      Object.defineProperty(instance, 'venylog', { writable: false, value: new Venylog(name || this.route) })\r\n      instance.onLoad.apply(instance, arguments);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 适配属性\r\n * @param {Object} target 目标对象 \r\n * @param {String} name 属性名称\r\n */\r\nfunction adapterProperty(target, name) {\r\n  var handler = target[name];\r\n  if (typeof handler === 'function') {\r\n    target[name] = adapterFunction(target, name);\r\n  } else {\r\n    target[name] = handler;\r\n  }\r\n}\r\n\r\n/**\r\n * 适配函数\r\n * @param {Object} target 目标对象 \r\n * @param {String} name 属性名称\r\n */\r\nfunction adapterFunction(target, name) {\r\n  var handler = target[name];\r\n  var locked = target.__locked;\r\n  return function () {\r\n    var nowHandler = target[name];\r\n    if (locked.indexOf(nowHandler) > -1) {\r\n      console.warn(`函数:${name}被锁定，您是否忘记解锁？ 解锁操作:this.unlock(this.${name})`)\r\n    } else {\r\n      return handler.apply(target, arguments);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 锁定指定函数\r\n */\r\nfunction lockFunction(handler) {\r\n  var locked = this.__locked;\r\n  if (typeof handler === 'function') {\r\n    if (locked.indexOf(handler) < 0) {\r\n      locked.push(handler);\r\n    }\r\n  }\r\n  var unlock = unLockFunction.bind(this);\r\n  return function (response) {\r\n    unlock(handler);\r\n    return response;\r\n  }\r\n}\r\n\r\n/**\r\n * 解锁指定函数\r\n */\r\nfunction unLockFunction(handler) {\r\n  var locked = this.__locked;\r\n  var index = locked.indexOf(handler);\r\n  if (typeof handler === 'function' && index >= 0) {\r\n    //延迟300毫秒解锁，防止函数在300毫秒内可并发调用\r\n    setTimeout(() => locked.splice(index, 1), 300);\r\n  }\r\n}"],"sourceRoot":""}