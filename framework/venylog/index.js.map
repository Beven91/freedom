{"version":3,"sources":["webpack:///../framework/venylog/index.js"],"names":["network","Network","Options","server","OriginalMapper","Venylog","config","name","pageName","record","push","coloration","event","entry","sendBeancon","original","isNnObject","filter","k","map","log","uri","encodeURIComponent","get","color","page"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA;;;;;;AAGA,IAAMA,UAAU,IAAIC,iBAAJ,EAAhB;AACA;AATA;;;;;AAUA,IAAMC,UAAU;AACdC,UAAQ;AAEV;AAHgB,CAAhB,CAIA,IAAMC,iBAAiB;AACrB,eAAY,MADS;AAErB,gBAAa,OAFQ;AAGrB,WAAQ,OAHa;AAIrB,UAAO,MAJc;AAKrB,gBAAa,OALQ;AAMrB,WAAQ;AANa,CAAvB;;IASqBC,O;;;;;AAEnB;;;;;;;2BAOcC,O,EAAQ;AACpB,4BAAcJ,OAAd,EAAuBI,OAAvB;AACD;;AAED;;;;;;;;AAKA,mBAAYC,IAAZ,EAAkB;AAAA;;AAChB,SAAKC,QAAL,GAAgBD,IAAhB;AACD;;AAED;;;;;;;;gCAIYE,M,EAAQ;AAClB,UAAIA,MAAJ,EAAY;AACV,aAAKC,IAAL,CAAU,KAAKC,UAAL,CAAgBF,MAAhB,CAAV;AACD;AACF;;AAED;;;;;;;;qCAKiBG,K,EAAOC,K,EAAO;AAC7B,aAAO,KAAKC,WAAL,CAAiB,EAAE,SAASF,KAAX,EAAkB,SAASC,KAA3B,EAAjB,CAAP;AACD;;AAED;;;;;;;wCAIoBE,Q,EAAU;AAC5B,UAAI,eAAKC,UAAL,CAAgBD,QAAhB,CAAJ,EAA+B;AAC7B,YAAMN,SAAS,EAAf;AACA,4BACQM,QADR,EAEGE,MAFH,CAEU,UAACC,CAAD;AAAA,iBAAOd,eAAec,CAAf,CAAP;AAAA,SAFV,EAGGC,GAHH,CAGO,UAACD,CAAD;AAAA,iBAAOT,OAAOL,eAAec,CAAf,CAAP,IAA4BH,SAASG,CAAT,CAAnC;AAAA,SAHP;AAIA,aAAKJ,WAAL,CAAiBL,MAAjB;AACD;AACF;;AAED;;;;;;;yBAIKW,G,EAAK;AACR,UAAMC,MAAMnB,QAAQC,MAAR,GAAiB,KAAjB,GAAyBmB,mBAAmBF,GAAnB,CAArC;AACApB,cAAQuB,GAAR,CAAYF,GAAZ;AACD;;AAED;;;;;;;+BAIWZ,M,EAAQ;AACjB,UAAIA,MAAJ,EAAY;AACV,YAAMe,QAAQ,EAAEC,MAAM,KAAKjB,QAAb,EAAuB,YAAY,QAAnC,EAAd;AACA,YAAMY,iCAAWX,MAAX,EAAsBe,KAAtB,CAAN;AACA,eAAO,yBAAeJ,GAAf,CAAP;AACD;AACF;;;;;kBA3EkBf,O","file":"../framework/venylog/index.js","sourcesContent":["/**\r\n * 名称：微信小程序打点工具\r\n * 日期:2017-12-29\r\n * 描述：基于小程序页面的图片组件发送打点日志\r\n */\r\nimport Network from '../network';\r\nimport { Type } from 'dantejs';\r\n\r\nconst network = new Network();\r\n//打点配置\r\nconst Options = {\r\n  server: ''\r\n}\r\n//属性映射\r\nconst OriginalMapper = {\r\n  'veny-name':'name',\r\n  'veny-event':'event',\r\n  'event':'event',\r\n  'name':'name',\r\n  'veny-param':'param',\r\n  'param':'param'\r\n}\r\n\r\nexport default class Venylog {\r\n\r\n  /**\r\n   * 全局配置打点信息\r\n   * @param config 配置对象 例如: \r\n   * {\r\n   *   server:'' //发送的服务端地址\r\n   * }\r\n   */\r\n  static config(config) {\r\n    Object.assign(Options, config);\r\n  }\r\n\r\n  /**\r\n   * Venylog构造函数\r\n   * @param {Page} page 页面实例 \r\n   * @param {String} name 打点页面名称\r\n   */\r\n  constructor(name) {\r\n    this.pageName = name;\r\n  }\r\n\r\n  /**\r\n   * 发送一条打点日志\r\n   * @param {Object} record\r\n   */\r\n  sendBeancon(record) {\r\n    if (record) {\r\n      this.push(this.coloration(record));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 发送一个事件日志\r\n   * @param {String} event 事件名称\r\n   * @param {String} entry 附带的消息 \r\n   */\r\n  sendEventBeancon(event, entry) {\r\n    return this.sendBeancon({ \"event\": event, \"param\": entry })\r\n  }\r\n\r\n  /**\r\n   * 发送一条映射日志，通过属性名称，映射成打点日志对象\r\n   * @param {Object} original 原始日志属性对象\r\n   */\r\n  sendOriginalBeancon(original) {\r\n    if (Type.isNnObject(original)) {\r\n      const record = {};\r\n      Object\r\n        .keys(original)\r\n        .filter((k) => OriginalMapper[k])\r\n        .map((k) => record[OriginalMapper[k]] = original[k]);\r\n      this.sendBeancon(record);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 将日志推入发送队列\r\n   * @param {String/Base64} log base64编码的日志数据\r\n   */\r\n  push(log) {\r\n    const uri = Options.server + '?s=' + encodeURIComponent(log);\r\n    network.get(uri);\r\n  }\r\n\r\n  /**\r\n   * 渲染打点日志对象通用数据\r\n   * @param {Object} record\r\n   */\r\n  coloration(record) {\r\n    if (record) {\r\n      const color = { page: this.pageName, \"platform\": \"arthur\" }\r\n      const log = { ...record, ...color };\r\n      return JSON.stringify(log);\r\n    }\r\n  }\r\n}"],"sourceRoot":""}